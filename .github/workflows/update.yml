name: Update summary for PRs

on:
    workflow_dispatch:
    pull_request:
        paths:
            - 'src/main/kotlin/org/koitharu/kotatsu/parsers/**'

env:
    SIGNER_USERNAME: YakaBot
    SIGNER_EMAIL: yakateam@proton.me

permissions:
    contents: write

jobs:
    update:
        runs-on: ubuntu-latest
        steps:
            -   name: Checkout repository üåè
                uses: actions/checkout@0c366fd6a839edf440554fa01a7085ccba70ac98 # v6.0.2
                with:
                    fetch-depth: 0
                    token: ${{ secrets.GITHUB_TOKEN }}

            -   name: Set up Java environment üîß
                uses: actions/setup-java@fe779bf55ef683c9413269276a7588bb9cedf07a # v5.2.0
                with:
                    java-version: '17'
                    distribution: 'temurin'

            -   name: Set up Gradle environment üì¶
                uses: gradle/actions/setup-gradle@0723195856401067f7a2779048b490ace7a47d7c # v5.0.2
                with:
                    gradle-version: '9.3.1'

            -   name: Compile the library üöÄ
                run: ./gradlew compileKotlin
                continue-on-error: true

            -   name: Check & Push summary üì§
                run: |
                    if git status --porcelain .github/summary.yaml | grep .; then
                        git config user.name "${{ env.SIGNER_USERNAME }}"
                        git config user.email "${{ env.SIGNER_MAIL }}"
                        git add .github/summary.yaml
                        git commit -m "chore: Update summary after compiling the library"
                        git push origin HEAD:${{ github.head_ref }}
                        echo "‚ÑπÔ∏è Summary updated"
                    else
                        echo "‚ÑπÔ∏è No changes in summary"
                    fi
